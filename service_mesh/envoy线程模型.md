1.集群管理器是Envoy中的组件，用于管理所有已知的上游集群，CDS API，SDS / EDS API，DNS和主动（带外）健康检查。它负责创建包括发现的主机以及健康状况的每个上游群集的最终一致的视图。
2.运行状况检查程序会执行主动运行状况检查，并将健康状况更改报告回群集管理器。
3.执行CDS / SDS / EDS / DNS以确定群集成员资格。状态更改会报告给集群管理器。
4.每个工作者线程都不断运行一个事件循环。
5.当群集管理器确定群集的状态已更改时，它会创建群集状态的新只读快照并将其发布到每个工作线程。
6.在下一个沉静期间，工作线程将更新分配的TLS插槽中的快照。
7.在需要确定主机负载均衡的IO事件期间，负载均衡器将查询主机信息的TLS插槽。无需获取锁做这个。 （还要注意，TLS还可以在更新时触发事件，以便负载平衡器和其他组件可以重新计算缓存，数据结构等。这超出了本文的范围，但在代码的不同位置使用。

通过使用前面描述的过程，Envoy能够处理每个请求，而不需要任何锁定（除了之前描述的那些锁定之外）。 除了TLS代码本身的复杂性之外，大多数代码不需要了解线程是如何工作的，并且可以写成单线程的。 除了有的性能外，还使得大多数代码更容易编写，。

## 其他使用TLS的子系统

在envoy中广泛使用TLS和RCU。 其他一些例子包括：
